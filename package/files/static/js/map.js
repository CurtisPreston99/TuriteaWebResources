Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1M2YwNTc4Ni0yNWYzLTQ2MTEtOGRkNC05OWFlODNlNTBkZWQiLCJpZCI6MTM5NTksInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1NjQ0NzQwMTl9.X_iNRe8-4jhYrUyAh8QNt3d6aHAfysLye_m0zBHmuiM";var west=175.60970056,south=-40.38724452,east=175.63276182,north=-40.37842748,pinBuilder=new Cesium.PinBuilder,viewer,cesiumHandler,kmlmenu=[],description="",image,ellipsoid,tag_types="airfield airport alcohol-shop america-football art-gallery bakery bank bar baseball basketball beer bicycle building bus cafe camera campsite car cemetery cesium chemist cinema circle circle-stroked city clothing-store college commercial cricket cross dam danger disability dog-park embassy emergency-telephone entrance farm fast-food ferry fire-station fuel garden gift golf grocery hairdresser harbor heart heliport hospital ice-cream industrial land-use laundry library lighthouse lodging logging london-underground marker marker-stroked minefield mobilephone monument museum music oil-well park2 parking-garage parking park pharmacy pitch place-of-worship playground police polling-place post prison rail-above rail-light rail-metro rail rail-underground religious-christian religious-jewish religious-muslim restaurant roadblock rocket school scooter shop skiing slaughterhouse soccer square square-stroked star star-stroked suitcase swimming telephone tennis theatre toilets town-hall town triangle triangle-stroked village warehouse waste-basket water wetland zoo".split(" "),scratchRectangle=new Cesium.Rectangle;function loadMap(){viewer=new Cesium.Viewer("cesiumContainer",{terrainProvider:new Cesium.CesiumTerrainProvider({url:Cesium.IonResource.fromAssetId(1)}),baseLayerPicker:!1,geocoder:!1,timeline:!1,animation:!1,homeButton:!1,fullscreenElement:cesiumContainer});ellipsoid=viewer.scene.globe.ellipsoid;cesiumHandler=new Cesium.ScreenSpaceEventHandler(viewer.canvas);viewer.infoBox.frame.removeAttribute("sandbox");$.getJSON("../api/listKML",function(a){var b=[{text:"Remove all KML Data",onselect:function(){viewer.dataSources.removeAll();loadpins()}}],c={camera:viewer.scene.camera,canvas:viewer.scene.canvas,clampToGround:!0};$.each(a,function(a,g){var d={};d.text=(a+1).toString()+"  "+g;d.onselect=function(){viewer.dataSources.add(Cesium.KmlDataSource.load("../api/getKML?name="+g,c))};b.push(d)});Sandcastle.addToolbarMenu(b,"toolbar")});var a=localStorage.getItem("viewerMiddle");a?(a=JSON.parse(a),a=Cesium.Rectangle.fromDegrees(a.lon-.005,a.lat-.005,a.lon+.005,a.lat+.005),viewer.camera.setView({destination:a})):(a=Cesium.Rectangle.fromDegrees(west,south,east,north),viewer.camera.setView({destination:a}));viewer.camera._changed.addEventListener(function(){loadpins()});loadpins()}function loadpins(){var a=viewer.camera.computeViewRectangle(viewer.scene.globe.ellipsoid,scratchRectangle),b=Cesium.Math.toDegrees(a.north),e=Cesium.Math.toDegrees(a.south),c=Cesium.Math.toDegrees(a.east),f=Cesium.Math.toDegrees(a.west);a="north="+b.toFixed(8)+"&south="+e.toFixed(8)+"&east="+c.toFixed(8)+"&west="+f.toFixed(8)+"&timeBegin=0&timeEnd=20000";$.getJSON("../api/getPins?"+a,function(a){0!==a.length&&(,viewer.entities.remove(temPin),null!==temPin&&viewer.entities.add(temPin),localStorage.setItem("viewerMiddle",JSON.stringify({lat:(e+b)/2,lon:(c+f)/2})),$.each(a,function(a,b){description="<p>Coordinates: ("+b.lon+", "+b.lat+")</p><hr><p style='display: none' id='inDescription'>"+b.uid.toString(16)+"</p>"+b.description;var c=tag_types.includes(b.tag_type)?pinBuilder.fromMakiIconId(b.tag_type,Cesium.Color.fromCssColorString(b.color),48):pinBuilder.fromColor(Cesium.Color.fromCssColorString(b.color),48);viewer.entities.add({id:b.uid.toString(16),name:b.name,position:Cesium.Cartesian3.fromDegrees(b.lon,b.lat),description:description,point:{show:!1,pixelSize:4,color:Cesium.Color.BLACK,outlineColor:Cesium.Color.fromCssColorString(b.color),outlineWidth:6},label:{show:!1,text:b.uid.toString(),font:"16pt Arial",fillColor:Cesium.Color.WHITE,style:Cesium.LabelStyle.FILL,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-12)},billboard:{image:c,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND},pin:b})}),)})}var temPin=null;function addTemporaryPin(a,b){null===temPin?temPin={id:"tem",name:"newPin",position:Cesium.Cartesian3.fromDegrees(a,b),point:{show:!1,pixelSize:4,color:Cesium.Color.BLACK,outlineColor:Cesium.Color.fromCssColorString("#ff0000"),outlineWidth:6},label:{show:!1,text:"tem",font:"16pt Arial",fillColor:Cesium.Color.WHITE,style:Cesium.LabelStyle.FILL,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-12)},billboard:{image:pinBuilder.fromColor(Cesium.Color.fromCssColorString("#ff0000"),48),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND},pin:{lat:b,lon:a,time:18711}}:temPin.position=Cesium.Cartesian3.fromDegrees(a,b);viewer.entities.removeById("tem");$("#lon").text(a);$("#lat").text(b);viewer.entities.add(temPin)}function addPinPrepare(){var a=$("#addP");a.text("select");a.off("click",addPinPrepare);a.on("click",selectAndCreate);cesiumHandler.setInputAction(selectPosition,Cesium.ScreenSpaceEventType.LEFT_CLICK);$("#cancelAdd").removeClass("two_hidden")}function cancelAdd(){$("#cancelAdd").addClass("two_hidden");var a=$("#addP");a.text("add pin");a.off("click",selectAndCreate);a.on("click",addPinPrepare);temPin=null;viewer.entities.removeById("tem");cesiumHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);$("#lon").text(0);$("#lat").text(0)}function selectAndCreate(){if(null===temPin){var a=$("#error-dialog");a.dialog({title:"error"});$("#error-dialog p").html("Please select a position!");a.dialog("open")}else a=$("#pin-dialog"),a.dialog({title:"edit pin"}),a.dialog("open"),$("#advance").show(),$("#longText").val(temPin.pin.lon),$("#latText").val(temPin.pin.lat)}function hidePins(){viewer.entities.show=!viewer.entities.show}function selectPosition(a){a=viewer.camera.pickEllipsoid(a.position,ellipsoid);if(Cesium.defined(a)){var b=ellipsoid.cartesianToCartographic(a);a=parseFloat(Cesium.Math.toDegrees(b.longitude));b=parseFloat(Cesium.Math.toDegrees(b.latitude));addTemporaryPin(a,b)}}function updatePin(){var a=$(".cesium-infoBox-iframe")[0].contentDocument.getElementById("inDescription");if(null===a){var b=$("#error-dialog");b.dialog({title:"No Select"});$("#error-dialog p").html("Please select a pin thank you!");b.dialog("open")}a=viewer.entities.getById(a.innerText).pin;b=$("#pin-dialog");b.dialog({title:"edit pin"});b.dialog("open");$("#advance").hide();$("#longText").val(a.lon);$("#latText").val(a.lat);$("#description").val(a.description);$("#name").val(a.name);$("#color").val(a.color);$("#iconSelect").val(a.tag_type);$("#pinId").val(a.uid)};