var home=$("#main");function loadMainFragment(){var b=document.cookie,a=$("#home"),c=b.indexOf("home");if(0>c)$("#at404").show(),a.hide();else{var d=b.substring(c,b.length).indexOf(";");(b=parseInt(b.substring(c+5,-1===d?b.length:d)))?(var c=JSON.parse(b);var d=c.content;c=c.res;for(var e=0;e<c.length;e++)"f"===c[e].type&&eachFragment($("<div></div>"),c[e].id);a.append($("<p></p>").append(d));a.append($("<span hidden></span>").text(b))}).fail(function(){$("#at404").show();a.hide()})):($("#at404").show(),a.hide())}}function eachFragment(b,a){$.get("../api/fragment?id="+a,function(a){var c=JSON.stringify(a).content;b.append($("<p></p>").append(c));b.append($("<span hidden></span>").text(a));home.append(b)})}var articleEditor,information=null,article=null;function loadArticleNote(){articleEditor=$("#articleSummerNote");articleEditor.summernote({height:500,codemirror:{theme:"monokai"},placeholder:"feel free to edit"});if(article=JSON.parse(localStorage.getItem("editArticle")))$("#articleTitle").text("edit article"),,articleEditor.summernote("code",article.content),$("#articleSum").val(article.sum),information=JSON.parse(article.home),}function editArticle(b){b=$(b);var a={};a.sum=$("#summary").text();a.content=b.children("p").html();a.home=b.children("span").text();a.id=$("#articleId").text();localStorage.setItem("editArticle",JSON.stringify(a));window.location.href="../html/settings.html#tabs-3"}function submitArticle(){var b=[];if(null!==information){var a=information.id;var c=information.res;for(a=0;a<c.length;a++)"m"===c[a].type&&b.push(c[a].m.uid.toString(16))}c={};a=articleEditor.summernote("code");a=$("<p></p>").append($.parseHTML(a));for(var d=a.find("img"),g=[],h=0;h<d.length;h++){var f=d[h],e=f.dataset.filename;f=$(f);var k=f.attr("src");k.startsWith("data:")&&(g.push({image:k.split(",")[1],title:e}),f.attr("src","../api/getImage?id=%x"))}c.images=JSON.stringify(g);c.imageNum=g.length;c.articles=JSON.stringify([{sum:$("#articleSum").val()}]);c.content=a.html();if(null!==information){var l=article.id;c.aid=l;for(a=0;a<b.length;a++)d=b[a],0>c.content.indexOf("../api/getImage?id="+d)&&($.post("../api/updateArticle",c,function(a){localStorage.setItem("editArticle",null);information=null;window.location.href="../article/"+l}).fail(function(a){})}else ,$.post("../api/addArticleWithImage",c,function(a){localStorage.setItem("editArticle",null);window.location.href="../article/"+a}).fail(function(a){error("Not login or other error","Please login thank you or check other things!")})}function deleteArticle(){var b=$("#articleId").text(),a=JSON.parse($("#home").children("span").html()).id;$.post("../api/delete?type=0&id="+a.toString(16),function(){$.post("../api/delete?type=4&id="+b.toString(16),function(){window.location.href="../html/articleList.html"}).fail(function(){error("Error","delete part success<br/>please contact system management")})}).fail(function(){error("Error","Login first")})};